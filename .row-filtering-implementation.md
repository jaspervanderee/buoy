# Row Filtering Implementation - Summary

## Overview
Successfully implemented selective row exclusion for service pages while keeping compare pages unchanged.

## What Changed

### 1. Enhanced `renderTableHTML` API (shared/renderTable.mjs)
Added options parameter with filtering capabilities:

```javascript
renderTableHTML(service, category, options = {})
```

**Options:**
- `mode`: "service" | "compare" (default: "compare")
- `includeRows`: string[] - explicit whitelist
- `excludeRows`: string[] - explicit blacklist

**Default Exclusions in Service Mode:**
- `type_of_platform` (Platform)
- `supported_network` (Supported Networks)
- `features` (Features)

**Priority Order:**
1. Service-level `spec_rows` override (from services.json)
2. Options `includeRows`
3. Options `excludeRows`
4. Mode defaults

### 2. Updated Service Page Builder (scripts/build-static.mjs)
Modified the call to pass `mode: "service"`:

```javascript
const tableHtml = await renderTableHTML(svc, svc.category, { mode: "service" });
```

### 3. Compare Pages (scripts/build-compare.mjs)
No changes needed - uses its own `renderCompareTableHTML()` function, keeping all rows intact.

## Usage Examples

### Per-Service Override
To selectively re-enable specific rows for a service, add `spec_rows` to services.json:

```json
{
  "name": "ServiceName",
  "category": "Store it safely",
  "spec_rows": ["supported_network", "price", "custody_control"],
  ...
}
```

This will render ONLY the specified rows for that service page (overriding all defaults).

### Manual Override in Code
To exclude different rows for a specific use case:

```javascript
// Exclude specific rows
await renderTableHTML(service, category, { 
  mode: "service",
  excludeRows: ["price", "fees"] 
});

// Or include only specific rows
await renderTableHTML(service, category, { 
  includeRows: ["custody_control", "user_experience", "website"] 
});
```

## Verification

### Service Pages (/services/*.html)
✓ No `type_of_platform` rows
✓ No `supported_network` rows  
✓ No `features` rows
✓ All other rows render normally
✓ No empty section headers or gaps

### Compare Pages (/compare/*.html)
✓ All rows still present including Platform/Supported/Features
✓ No regressions in layout or content

### Client-Side (compare.js)
✓ No errors when rows are missing
✓ Hydration only attempts for existing rows
✓ No console warnings

## Future Extensibility

To re-enable any of the three excluded rows later:

**For all service pages:**
Modify `serviceExclusions` array in `shared/renderTable.mjs`

**For specific services:**
Add `spec_rows` field to that service in `services.json`

**For programmatic control:**
Pass `includeRows` or `excludeRows` in the options object

## Files Modified
- `/shared/renderTable.mjs` - Added filtering logic
- `/scripts/build-static.mjs` - Pass mode: "service"

## Files Unchanged
- `/scripts/build-compare.mjs` - Uses separate renderer
- `/js/compare.js` - Client-side hydration unchanged
- All HTML templates - No structural changes

## Build Command
```bash
node scripts/build-static.mjs
```

## Notes
- Clean, native exclusion at render time (no post-processing)
- Fully backward compatible (defaults to "compare" mode)
- No impact on JSON-LD, breadcrumbs, or other sections
- Per-service overrides via data (no code changes needed)

